# GPG PORTABLE KIT
**Version 1.5**  
**Operational Guide for Recipients**  
*Secure system for receiving and decrypting sensitive and confidential data*

---

## TABLE OF CONTENTS

1. [Introduction to the GPG Kit](#1-introduction-to-the-gpg-kit)
2. [Kit Contents](#2-kit-contents)
3. [Initial Setup: Generating Your Keys](#3-initial-setup-generating-your-keys)
4. [Mandatory Setup: Verifying the Sender's Key](#4-mandatory-setup-verifying-the-senders-key)
5. [Sending Your Public Key to the Sender](#5-sending-your-public-key-to-the-sender)
6. [Receiving and Decrypting Files](#6-receiving-and-decrypting-files)
7. [Digital Signature Verification](#7-digital-signature-verification)
8. [Managing Multiple Keys](#8-managing-multiple-keys)
9. [Secure USB Drive Management](#9-secure-usb-drive-management)
10. [Troubleshooting](#10-troubleshooting)
11. [FAQ ‚Äî Frequently Asked Questions](#11-faq--frequently-asked-questions)
12. [Appendix: Glossary](#appendix-glossary)

---

## 1. INTRODUCTION TO THE GPG KIT

### 1.1 What is the GPG Kit

The GPG Kit is a portable, self-contained system for securely receiving and decrypting sensitive data. It is designed to run directly from a USB drive, with no need to install anything on the computer.

### 1.2 How it works ‚Äî a simple analogy

Think of a mailbox with two keys:

- **The public key** is like the mail slot: anyone can insert a message (encrypt a file for you), but only you can open the box.
- **The private key** is the key to the lock: only you have it, and only with it can you read the received messages (decrypt the files).

> ‚ö†Ô∏è **IMPORTANT**  
> The private key never leaves the USB drive. Encrypted files can only be decrypted by whoever holds that key. If you lose it, you lose access to the data.

### 1.3 The secure exchange process ‚Äî end to end

The complete workflow, described step by step in this guide, is as follows:

```
[YOU]                                       [SENDER]
  |                                              |
  |-- 1. Generate your key pair                  |
  |        (Setup_keys.cmd)                      |
  |                                              |
  |-- 2. Send your PUBLIC key ----------------->|
  |        (via email / PEC)                     |
  |                                              |
  |<-- 3. Receive the sender's PUBLIC key -------|
  |                                              |
  |-- 4. VERIFY and declare the sender's         |
  |        key trusted                           |
  |        (Setup_Trust.cmd) ‚Üê MANDATORY        |
  |                                              |
  |        [Sender encrypts the file with your   |
  |         public key and signs it with their   |
  |         private key]                         |
  |                                              |
  |<-- 5. Receive the encrypted file ------------|
  |        (extension .gpg)                      |
  |                                              |
  |-- 6. Decrypt and verify the signature        |
  |        (decifra.cmd + verifica.cmd)           |
```

---

## 2. KIT CONTENTS

### 2.1 Folder structure

```
KIT_GPG/
‚îú‚îÄ‚îÄ run/                        ‚Üê Scripts to run
‚îÇ   ‚îú‚îÄ‚îÄ Setup_keys.cmd          ‚Üê Generate and manage your keys
‚îÇ   ‚îú‚îÄ‚îÄ Setup_Trust.cmd         ‚Üê Verify and trust the sender's key
‚îÇ   ‚îú‚îÄ‚îÄ decifra.cmd             ‚Üê Decrypt received files
‚îÇ   ‚îú‚îÄ‚îÄ verifica.cmd            ‚Üê Verify digital signatures
‚îÇ   ‚îî‚îÄ‚îÄ diagnostica.cmd         ‚Üê Diagnostics and troubleshooting
‚îÇ
‚îú‚îÄ‚îÄ trust/                      ‚Üê Sender's public key (provided by sender)
‚îÇ   ‚îú‚îÄ‚îÄ publickey.asc           ‚Üê Sender's public key
‚îÇ   ‚îî‚îÄ‚îÄ fingerprint.txt         ‚Üê Key fingerprint (for verification)
‚îÇ
‚îú‚îÄ‚îÄ home/                       ‚Üê GPG keyring ‚Äî do NOT touch, do NOT share
‚îú‚îÄ‚îÄ in/                         ‚Üê Recommended folder for incoming encrypted files
‚îú‚îÄ‚îÄ out/                        ‚Üê Recommended folder for decrypted files
‚îú‚îÄ‚îÄ docs/                       ‚Üê This guide and the quick reference
‚îú‚îÄ‚îÄ reports/                    ‚Üê Reports generated by the scripts
‚îî‚îÄ‚îÄ public_key_*.asc            ‚Üê Your public key (to send to the sender)
```

### 2.2 Available scripts

| Script | Function | When to use |
|--------|----------|-------------|
| **Setup_keys.cmd** | Generate and manage your personal keys | Initial setup, new keys, export |
| **Setup_Trust.cmd** | Verify and trust the sender's key | **Mandatory** before decrypting for the first time |
| **decifra.cmd** | Decrypt received `.gpg` files | Every time you receive an encrypted file |
| **verifica.cmd** | Verify the digital signature | To check authenticity and integrity |
| **diagnostica.cmd** | Diagnose issues | When something is not working |

---

## 3. INITIAL SETUP: GENERATING YOUR KEYS

> This step needs to be performed **only once**, unless you need to create a new key in the future.

### 3.1 Copy the Kit to a USB drive

1. Insert a USB drive into the computer
2. Extract the contents of the ZIP file you received
3. Copy the entire `KIT_GPG` folder to the USB drive
4. Verify that all files were copied correctly

### 3.2 Generate your first key

1. Open the `run` folder on the USB drive
2. Double-click **`Setup_keys.cmd`**
3. If you have no keys yet, the script will start the generation automatically

The script will ask for:

- **First and Last Name** ‚Äî enter your full name (e.g. `John Smith`)
- **Email** ‚Äî your email address
- **Comment** ‚Äî optional, useful to distinguish keys (e.g. `Work`)
- **Passphrase** ‚Äî a strong password to protect the private key

> ‚ö†Ô∏è **CHOOSING YOUR PASSPHRASE**  
> The passphrase is the only protection for your private key. It must be:
> - At least 12 characters long, with letters, numbers and symbols
> - Easy for you to remember, impossible for others to guess
> - **Written down OFFLINE** (paper, not a digital file) and kept in a safe place
> - **Not recoverable**: if you forget it, the key becomes unusable

### 3.3 What happens when done

At the end of the generation, the script:

1. Saves the private key in the keyring (`home/` folder) ‚Äî **never share this**
2. Exports the public key to the kit root as `public_key_John_Smith.asc`

Continue with steps 4 and 5 before telling the sender you are ready.

---

## 4. MANDATORY SETUP: VERIFYING THE SENDER'S KEY

> ‚ö†Ô∏è **THIS STEP IS MANDATORY**  
> Without it, GPG does not trust the sender's key and signature verification will always fail, even if the file is genuine.

### 4.1 What this is and why it matters

When you receive the sender's public key, you must:
1. **Verify** that it is authentic (that it genuinely comes from the sender, not a third party)
2. **Declare** to GPG that you trust that key

Without this step, GPG cannot determine whether the signature on the file you receive is genuine.

### 4.2 What you need

Before running `Setup_Trust.cmd`, the sender must have provided:

| File / Data | Location | Purpose |
|-------------|----------|---------|
| `publickey.asc` | `trust/` folder of the kit | Sender's public key |
| `fingerprint.txt` | `trust/` folder of the kit | Unique fingerprint of the key |
| Fingerprint via email/PEC | In the sender's communication | Verification on an independent channel (optional but recommended) |

### 4.3 Run Setup_Trust.cmd

1. Open the `run` folder on the USB drive
2. Double-click **`Setup_Trust.cmd`**
3. The script automatically:
   - Imports the sender's public key into the keyring
   - Reads the expected fingerprint from `trust/fingerprint.txt`
   - Compares the imported key's fingerprint with the expected one
   - If they match: displays the result and offers email verification

### 4.4 Email verification (second channel ‚Äî recommended)

After the automatic check, the script offers an additional verification:

```
Fingerprint: A893C524F394623C8B9CF6F14AE4DCB5D131BBB3

Enter fingerprint from email (or press ENTER to skip):
```

- If you received the fingerprint via email/PEC from the sender, enter it here
- If it matches ‚Üí **ULTIMATE trust (level 5)**: maximum security, dual verification
- If you press ENTER without entering anything ‚Üí **FULL trust (level 4)**: single kit file verification

> ‚ÑπÔ∏è **Difference between the two levels**  
> - **FULL**: you verified that the key in the kit matches the fingerprint in the kit. Sufficient for normal use.  
> - **ULTIMATE**: you verified the key on two independent channels (kit file + email). Recommended for highly sensitive documents.

### 4.5 What to do if fingerprints do NOT match

If the script reports a discrepancy:

> ‚ùå **CRITICAL ERROR: Fingerprint does NOT match! Possible key tampering.**

**Do not proceed.** Contact the sender immediately through a different channel (phone, separate PEC) to report the anomaly. Do not use the received file until you have clarity.

### 4.6 When to repeat this step

- Every time the sender sends you a **new public key** (e.g. after annual renewal)
- If `diagnostica.cmd` reports the key is not in the keyring
- If you always get signature errors even on correct files

---

## 5. SENDING YOUR PUBLIC KEY TO THE SENDER

After generating your keys (step 3), you must send your **public** key to the sender. This is the only way they can encrypt files intended for you.

### 5.1 Where to find the file

In the main kit folder you will find:
```
public_key_John_Smith.asc
```
where `John_Smith` is the name you entered during generation.

### 5.2 How to send it

- **Email / PEC**: as an attachment to the sender's contact
- **Web portal**: upload to a dedicated platform, if available
- **Other channel**: as instructed

> ‚úÖ **The public key can be shared freely.** It contains no confidential information. Only the **private key** (which stays on the USB drive) must remain secret.

### 5.3 What to include with the key

When sending your public key, it is good practice to also include the fingerprint, so the sender can verify they received the correct key. The fingerprint is visible by running `diagnostica.cmd`.

---

## 6. RECEIVING AND DECRYPTING FILES

### 6.1 Receiving the encrypted file

1. You will receive the `.gpg` file via email, PEC or portal
2. Save it directly on the USB drive (recommended in the `in/` folder)
3. Avoid saving it on the computer's hard drive

### 6.2 Decrypt with Drag & Drop (recommended method)

1. Open the `run` folder on the USB drive
2. Drag the `.gpg` file onto **`decifra.cmd`**
3. A window will open asking for the passphrase
4. Enter your private key passphrase
5. The decrypted file will appear in the same folder as the `.gpg` file

### 6.3 Decrypt with double-click

1. Double-click `decifra.cmd`
2. When prompted, drag the `.gpg` file into the window
3. Press Enter and enter the passphrase

### 6.4 Where to find the decrypted file

The decrypted file is saved in the same folder as the `.gpg` file, with the same name but without the `.gpg` extension:

```
confidential_document.pdf.gpg   ‚Üí   confidential_document.pdf
```

### 6.5 Interpreting the result

| Displayed result | Meaning |
|-----------------|---------|
| `[OK] File decrypted successfully` | Everything OK, valid signature |
| `[OK] File decrypted with WARNINGS` | Decrypted, but trust not fully validated ‚Äî run Setup_Trust.cmd |
| `Decryption failed - Bad passphrase` | Wrong passphrase, try again |
| `Decryption failed - No secret key` | Sender used a different public key ‚Äî resend your current public key |

---

## 7. DIGITAL SIGNATURE VERIFICATION

The digital signature guarantees that the file genuinely came from the declared sender and was not altered in transit.

### 7.1 How to verify

1. Open the `run` folder
2. Drag the `.gpg` file onto **`verifica.cmd`**
3. The script automatically verifies the signature
4. A detailed report is saved in the `reports/` folder

> ‚ÑπÔ∏è For a complete verification result (GOOD SIGNATURE), you must have previously run **Setup_Trust.cmd** (section 4).

### 7.2 Interpreting the results

| Result | Meaning | Action |
|--------|---------|--------|
| ‚úÖ **GOOD SIGNATURE (TRUST OK)** | Valid signature, trusted key | Proceed with decryption |
| üü° **SIGNATURE OK but TRUST not verified** | Technically valid signature, but key not declared trusted | Run Setup_Trust.cmd, then verify again |
| ‚ùå **BAD SIGNATURE** | File has been altered or signature is not authentic | Do not open the file, contact the sender |
| ‚ö†Ô∏è **Public key missing** | Sender's key not imported | Run Setup_Trust.cmd |

---

## 8. MANAGING MULTIPLE KEYS

### 8.1 Why have multiple keys

- Separate different contexts (work, projects, organisations)
- Periodically renew keys while keeping old ones for historical files
- Have a dedicated key for each sender/organisation

### 8.2 Managing keys with Setup_keys.cmd

When you run `Setup_keys.cmd` with keys already present, you will see a menu:

```
================== KEY SELECTION ==================
Found 2 keys.

  [1] John Smith
  [2] John Smith - Work

Select number [1-2] or [G] to generate:
```

After selecting a key:

```
================== MENU ==================
Selected key: John Smith
Fingerprint: A893C524...

 [U] Use this key (export public key)
 [D] Delete this key
 [S] Change key
 [Q] Quit
```

### 8.3 Deleting a key

> ‚ö†Ô∏è **Irreversible operation.** After deletion it will no longer be possible to decrypt files received with that key, and it cannot be recovered.

Select the key, then press `[D]` and confirm with `S`.

---

## 9. SECURE USB DRIVE MANAGEMENT

### 9.1 Ground rules

‚úÖ **DO:**
- Keep the drive in a safe place (safe, locked drawer)
- Create a backup on a second USB drive
- Update the backup after every key change
- Write down passphrases offline

‚ùå **DON'T:**
- Never copy the `home/` folder to the computer's hard drive
- Never share the private key or passphrase
- Never leave the USB drive unattended

### 9.2 Creating a backup

1. Use a second USB drive
2. Copy the entire `KIT_GPG` folder to the second drive
3. Verify all files were copied
4. Keep the backup in a physically separate location from the original

> ‚ö†Ô∏è **Without a backup, losing or damaging the USB drive means permanent loss of all keys and the inability to decrypt already received files.**

---

## 10. TROUBLESHOOTING

### 10.1 Use diagnostica.cmd as the first step

When problems occur, run `diagnostica.cmd` first: it checks the kit structure, present keys, GPG configuration and generates a complete report.

### 10.2 Common issues

| Problem | Likely cause | Solution |
|---------|-------------|---------|
| `decryption failed: No secret key` | Sender used a different public key | Resend the correct public key to the sender |
| `decryption failed: Bad passphrase` | Wrong passphrase | Try again; check CAPS LOCK |
| Signature verification: TRUST not verified | Setup_Trust.cmd not run | Run Setup_Trust.cmd (section 4) |
| Signature verification: key missing | Sender key not imported | Run Setup_Trust.cmd (section 4) |
| Script startup error | Path contains special characters | Move the kit to a simple path (e.g. `E:\KIT_GPG`) |

### 10.3 Forgotten passphrase

> ‚ö†Ô∏è **No recovery possible.** If you have forgotten a key's passphrase, that key is unusable.

Solution: generate a new key with `Setup_keys.cmd`, send it to the sender and ask them to re-encrypt important files with the new key.

### 10.4 Full reset

If you need to start from scratch:

1. Decrypt all important files that are still accessible
2. Delete the `home/` folder from the USB drive
3. Delete all `public_key_*.asc` files from the kit root
4. Run `Setup_keys.cmd` again
5. Send the new public keys to the senders

---

## 11. FAQ ‚Äî FREQUENTLY ASKED QUESTIONS

**Q: Can I use the kit on multiple computers?**  
A: Yes. The kit is completely portable ‚Äî no installation required on any Windows PC.

**Q: Do I need to repeat Setup_Trust.cmd every time?**  
A: No. Run it once per sender key. Repeat only if the sender renews their public key.

**Q: What if the USB drive is damaged?**  
A: If you have a backup, use that. Otherwise you will need to redo the complete setup with new keys and ask the sender to re-encrypt the documents.

**Q: Can the sender read files after encrypting them?**  
A: Only if the file was also encrypted for their own key. Files encrypted exclusively with your public key can only be decrypted by you.

**Q: Is an Internet connection required?**  
A: No. The kit works completely offline.

**Q: Can I share the private key in exceptional circumstances?**  
A: Never. There is no exceptional circumstance that justifies sharing the private key.

**Q: How do I know which key to use for decryption?**  
A: GPG recognises it automatically and asks for the correct key's passphrase.

**Q: How often should I back up?**  
A: After every key generation or deletion, and every time you receive important decrypted files.

---

## APPENDIX: GLOSSARY

**Public key** ‚Äî Can be shared freely. Used by the sender to encrypt files intended for you.

**Private key** ‚Äî Must remain absolutely secret. Used by you to decrypt received files.

**Fingerprint** ‚Äî Unique digital fingerprint of a GPG key: a 40-character hexadecimal string that identifies a specific key. Used to verify that two copies of the same key are identical.

**Passphrase** ‚Äî Password that protects the private key. Without it the key cannot be used.

**Trust** ‚Äî Explicit declaration that a public key genuinely belongs to the indicated person. GPG does not automatically trust any key until it is declared trusted.

**Digital signature** ‚Äî Cryptographic mechanism that guarantees authenticity (who created/sent the file) and integrity (the file has not been modified).

**`.gpg` file** ‚Äî File encrypted with GPG. May contain both the encrypted data and the digital signature.

**`.asc` file** ‚Äî Text format (ASCII armor) used to export GPG keys.

**AEAD** ‚Äî Advanced Encryption with Associated Data: modern encryption mode used by GPG 2.3+, more secure than the classic mode.

**GPG (GNU Privacy Guard)** ‚Äî Open source software implementing the OpenPGP standard for encryption and digital signatures.

---

*GPG Kit Version 1.5*  
*For technical support, contact your internal reference person*
